<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dijital Kartvizit</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Header -->
    <div class="fixed-header">
        <div class="banner-container">
            <img src="banner.jpg" alt="Banner" class="banner-img" onerror="this.style.display='none'">
        </div>
        <div class="profile-container">
            <img src="profil.jpg" alt="Profil" class="profile-img" onerror="this.src='https://via.placeholder.com/150'">
        </div>
    </div>

    <!-- Content -->
    <div class="scroll-content">
        <div class="card-body">
            
            <!-- Başlık -->
            <div class="header-info">
                <h1 class="name" id="vcf-name">Yükleniyor...</h1>
                <p class="company" id="vcf-company">...</p>
                <p class="title" id="vcf-title">...</p>
            </div>

            <!-- 5'li Butonlar -->
            <div class="action-buttons">
                <a href="#" id="btn-call" class="action-btn">
                    <div class="icon-box"><svg class="icon"><use href="icons.svg#phone"></use></svg></div>
                    <span>Ara</span>
                </a>
                <a href="#" id="btn-email" class="action-btn">
                    <div class="icon-box"><svg class="icon"><use href="icons.svg#mail"></use></svg></div>
                    <span>E-mail</span>
                </a>
                <button onclick="openQR()" class="action-btn">
                    <div class="icon-box"><svg class="icon"><use href="icons.svg#qr"></use></svg></div>
                    <span>QR</span>
                </button>
                <a href="#" id="btn-whatsapp" target="_blank" class="action-btn">
                    <div class="icon-box"><svg class="icon"><use href="icons.svg#whatsapp"></use></svg></div>
                    <span>WhatsApp</span>
                </a>
                <a href="iletisim.vcf" download class="action-btn highlight-btn">
                    <div class="icon-box"><svg class="icon"><use href="icons.svg#add-user"></use></svg></div>
                    <span>Kişilere Ekle</span>
                </a>
            </div>

            <!-- İletişim Listesi -->
            <div class="info-list">
                <!-- Cep Tel -->
                <div class="info-item">
                    <svg class="list-icon"><use href="icons.svg#mobile"></use></svg>
                    <div class="list-text">
                        <span class="label">Cep Telefonu</span>
                        <span class="value" id="vcf-mobile">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-mobile')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- İş Tel -->
                <div class="info-item">
                    <svg class="list-icon"><use href="icons.svg#phone-classic"></use></svg>
                    <div class="list-text">
                        <span class="label">İş Telefonu</span>
                        <span class="value" id="vcf-work">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-work')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- Email -->
                <div class="info-item">
                    <svg class="list-icon"><use href="icons.svg#mail"></use></svg>
                    <div class="list-text">
                        <span class="label">E-posta</span>
                        <span class="value" id="vcf-email-text">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-email-text')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- Website -->
                <div class="info-item">
                    <svg class="list-icon"><use href="icons.svg#web"></use></svg>
                    <div class="list-text">
                        <span class="label">Web Sitesi</span>
                        <span class="value" id="vcf-web">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-web')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>
            </div>

            <!-- Harita (Adres yazısı kaldırıldı) -->
            <div class="map-section">
                <h3>Adres Bilgileri</h3>
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3006.837687749637!2d29.0208!3d41.1014!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab5d4f628693f%3A0x2e60663769484337!2sOsmanl%C4%B1%20Yat%C4%B1r%C4%B1m%20Menkul%20De%C4%9Ferler%20A.%C5%9E.!5e0!3m2!1str!2str" 
                width="100%" height="200" style="border:0; border-radius:10px; margin-bottom:10px;" allowfullscreen="" loading="lazy"></iframe>
                
                <a href="#" id="btn-direction" target="_blank" class="directions-btn">
                    <svg class="icon-sm" style="fill:white; margin-right:5px;"><use href="icons.svg#navigation"></use></svg>
                    Yol Tarifi Al
                </a>
            </div>

            <!-- SOSYAL MEDYA -->
            <div class="social-section">
                <h3>Sosyal Medya</h3>
                <a href="#" id="btn-linkedin" target="_blank" class="social-btn linkedin" style="display:none;">
                    <svg class="icon-white"><use href="icons.svg#linkedin"></use></svg>
                </a>
            </div>

            <!-- ŞİRKET BİLGİLERİ (Tüm satırlara kopyalama eklendi) -->
            <div class="company-section">
                <h3>Şirket Bilgileri</h3>
                
                <!-- Şirket Adı -->
                <div class="company-item">
                    <svg class="list-icon"><use href="icons.svg#building"></use></svg>
                    <div class="list-text">
                        <span class="label">Şirket Adı</span>
                        <span class="value" id="vcf-comp-name">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-comp-name')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- Şirket Adresi -->
                <div class="company-item">
                    <svg class="list-icon"><use href="icons.svg#location"></use></svg>
                    <div class="list-text">
                        <span class="label">Şirket Adresi</span>
                        <span class="value" id="vcf-comp-address">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-comp-address')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- Vergi Dairesi -->
                <div class="company-item">
                    <svg class="list-icon"><use href="icons.svg#tax-office"></use></svg>
                    <div class="list-text">
                        <span class="label">Vergi Dairesi</span>
                        <span class="value" id="vcf-tax-office">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-tax-office')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>

                <!-- Vergi No -->
                <div class="company-item">
                    <svg class="list-icon"><use href="icons.svg#card"></use></svg>
                    <div class="list-text">
                        <span class="label">Vergi No</span>
                        <span class="value" id="vcf-tax-no">...</span>
                    </div>
                    <button class="copy-btn-box" onclick="copyToClipboard('vcf-tax-no')">
                        <svg class="icon-sm"><use href="icons.svg#copy"></use></svg>
                    </button>
                </div>
            </div>
            
            <footer>&copy; 2024 <span id="footer-name"></span></footer>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQR()">&times;</span>
            <h3>QR Kodunuz</h3>
            <img src="qr.svg" alt="QR Kod" class="modal-qr">
        </div>
    </div>

  <script>
        // QR Kod
        function openQR() { document.getElementById("qrModal").style.display = "flex"; }
        function closeQR() { document.getElementById("qrModal").style.display = "none"; }
        window.onclick = function(e) { if(e.target == document.getElementById("qrModal")) closeQR(); }

        // Kopyalama Fonksiyonu
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            if (!text || text === "...") return; // Boşsa kopyalama
            
            navigator.clipboard.writeText(text).then(function() {
                alert("Kopyalandı: " + text);
            }, function(err) {
                console.error('Hata:', err);
            });
        }

        // VCF Okuma
        fetch('iletisim.vcf')
            .then(response => response.text())
            .then(vcfText => {
                console.log("VCF Okundu");
                parseVCF(vcfText);
            })
            .catch(error => console.error('Hata:', error));

        function parseVCF(data) {
            // Yardımcı regex fonksiyonu
            const getTag = (regex) => {
                const match = data.match(regex);
                return match ? match[1].trim() : "";
            };

            // 1. İSİM VE ŞİRKET
            // UTF-8 bozukluklarını önlemek için decode denemesi yapılabilir ama basit regex:
            let fullName = getTag(/FN;?.*:(.*)/); 
            if(!fullName) fullName = getTag(/FN:(.*)/);

            let org = getTag(/ORG;?.*:(.*)/); // Noktalı virgül varsa temizle
            org = org.split(';')[0]; // Bazen ORG:Şirket;Departman formatında gelir, sadece ilkini al.
            
            const title = getTag(/TITLE;?.*:(.*)/);
            
            // 2. TELEFONLAR
            const mobileMatch = data.match(/TEL;.*TYPE=.*CELL.*:(.*)/i) || data.match(/TEL;.*VOICE.*:(.*)/i);
            let mobile = mobileMatch ? mobileMatch[1] : "";

            const workMatch = data.match(/TEL;.*TYPE=.*WORK.*:(.*)/i);
            let workPhone = workMatch ? workMatch[1] : "";

            // 3. E-POSTA VE WEB
            const email = getTag(/EMAIL;?.*:(.*)/);
            // Tüm URL'leri bulalım (Linkedin için lazım olacak)
            const allUrls = [...data.matchAll(/URL;?.*:(.*)/gi)].map(m => m[1].trim());
            let website = allUrls.length > 0 ? allUrls[0] : "";

            // 4. ADRES (Kritik Düzeltme)
            // Önce LABEL (Özel format) ara, bulamazsan ADR (Standart format) ara
            let address = "";
            const labelMatch = data.match(/LABEL(?:;[^:]*)*:(.*)/i);
            
            if (labelMatch) {
                address = labelMatch[1].trim().replace(/\\n/g, " ");
            } else {
                // Standart ADR formatı: ADR:;;Sokak;Şehir;Eyalet;Posta;Ülke
                const adrMatch = data.match(/ADR(?:;[^:]*)*:(.*)/i);
                if (adrMatch) {
                    // Noktalı virgülleri boşlukla değiştir ve temizle
                    address = adrMatch[1].replace(/;/g, " ").replace(/\\n/g, " ").replace(/\s+/g, ' ').trim();
                }
            }

            // 5. SOSYAL MEDYA (LinkedIn Düzeltmesi)
            // Önce özel X-SOCIALPROFILE etiketine bak, yoksa URL'lerin içinde "linkedin" ara
            let linkedin = getTag(/X-SOCIALPROFILE.*linkedin:(.*)/i) || getTag(/X-LINKEDIN:(.*)/i);
            
            if (!linkedin) {
                const linkedinUrl = allUrls.find(url => url.toLowerCase().includes("linkedin.com"));
                if (linkedinUrl) linkedin = linkedinUrl;
            }

            // 6. VERGİ BİLGİLERİ (Kritik)
            // Standart VCF'lerde vergi no olmaz. Eğer dosya güncellendiyse bunlar silinmiştir.
            // Eğer silindiyse HTML içinde varsayılan değer gösterilmemesi için kontrol koyuyoruz.
            const taxOffice = getTag(/X-TAX-OFFICE:(.*)/);
            const taxNo = getTag(/X-TAX-NUMBER:(.*)/);

            // --- HTML DOLDURMA ---
            
            if(fullName) {
                document.getElementById('vcf-name').textContent = fullName;
                document.getElementById('footer-name').textContent = fullName;
            }
            if(org) {
                document.getElementById('vcf-company').textContent = org;
                document.getElementById('vcf-comp-name').textContent = org;
            }
            if(title) document.getElementById('vcf-title').textContent = title;

            // Telefonlar
            if(mobile) {
                document.getElementById('btn-call').href = "tel:" + mobile;
                const cleanMobile = mobile.replace(/[^0-9]/g, '');
                document.getElementById('btn-whatsapp').href = "https://wa.me/" + cleanMobile;
                document.getElementById('vcf-mobile').textContent = mobile;
            }

            if(workPhone) {
                document.getElementById('vcf-work').textContent = workPhone;
            } else {
                // Eğer iş telefonu yoksa o satırı gizleyebilirsin veya boş bırakırsın
                document.getElementById('vcf-work').textContent = "-";
            }
            
            // Email & Web
            if(email) {
                document.getElementById('btn-email').href = "mailto:" + email;
                document.getElementById('vcf-email-text').textContent = email;
            }
            if(website) {
                // Protokol temizliği
                const cleanWeb = website.replace(/^https?:\/\//, '');
                document.getElementById('vcf-web').textContent = cleanWeb;
            }

            // Adres ve Harita
            if(address) {
                document.getElementById('btn-direction').href = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(address);
                document.getElementById('vcf-comp-address').textContent = address;
            } else {
                document.getElementById('vcf-comp-address').textContent = "-";
            }

            // LinkedIn Göster/Gizle
            const liBtn = document.getElementById('btn-linkedin');
            if (linkedin) {
                liBtn.style.display = "flex";
                liBtn.href = linkedin.startsWith('http') ? linkedin : 'https://' + linkedin;
            } else {
                liBtn.style.display = "none";
            }

            // Vergi Bilgileri
            // Eğer VCF'den gelmiyorsa "..." yerine "-" koyuyoruz ki boş olduğu belli olsun
            document.getElementById('vcf-tax-office').textContent = taxOffice ? taxOffice : "—";
            document.getElementById('vcf-tax-no').textContent = taxNo ? taxNo : "—";
        }
    </script>
</body>
</html>

